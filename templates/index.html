<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en" class="busyCursor">
<head>
    <title>ResearchParÃ§a Lite</title>    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“Š</text></svg>">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='fonts.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">

    <script src="{{ url_for('static', filename='libs/chart.min.js') }}"></script>
    <script src="{{ url_for('static', filename='libs/chartjs-plugin-datalabels.min.js') }}"></script>
    <script src="{{ url_for('static', filename='libs/d3.min.js') }}"></script>
    <script src="{{ url_for('static', filename='libs/d3-cloud.min.js') }}"></script>
    
    <script src="{{ url_for('static', filename='stats.js') }}" defer></script>
    <script src="{{ url_for('static', filename='comms.js') }}" defer></script>
    <script src="{{ url_for('static', filename='filtering.js') }}" defer></script>
    
</head>
<body>
<input type="file" id="bibtex-file-input" accept=".bib" style="display: none;"> <!-- Hidden file input for BibTeX upload -->
<div class="table-container" id="papers-table-container">
    <table id="papersTable" style="table-layout: fixed;">
        <colgroup>
            <col style="width: 27px; min-width: 27px; max-width: 27px;"> <!-- PDF (Rotated Header) -->
            <col style="width: 50%"> <!-- Title (Should Expand)-->
            <col style="width: 25%"> <!-- Title (Should Expand)-->
            <col style="width: 40px; min-width: 40px; max-width:40px;"> <!--  Year -->
            <col style="width: 27px; min-width: 27px; max-width: 27px;"> <!-- Pages (Rotated Header) -->
            <col style="width: 25%"> <!-- Journal/Conf (Should Expand) -->
            <col style="width: 27px; min-width: 27px; max-width: 27px;"> <!-- Type (Rotated Header) -->
            <col style="width: 27px; min-width: 27px; max-width: 27px;"> <!-- Off-topic -->
            <col style="width: 27px; min-width: 27px; max-width: 27px;"> <!-- Relevance -->
            <col style="width: 27px; min-width: 27px; max-width: 27px;"> <!-- Survey -->

            <col style="width: 56px; min-width: 56px; max-width: 56px;"> <!-- Last Changed -->
            <col style="width: 27px; min-width: 27px; max-width: 27px;"> <!-- user comments state -->
            <col style="width: 44px; min-width: 44px; max-width: 44px;"> <!-- Details -->          
            
            <!-- hidden metadata fields -->
            <col style="display:none"> 
            <col style="display:none"> 
            <col style="display:none"> 
            <col style="display:none"> 
        </colgroup>
        <thead>
            <tr>
                <th id="main-header-wrapper" colspan="17">
                    <div class="main-header">
                        <div class="header-controls">
                            <button class="action-btn" id="import-btn" style="display:none">Import / Restore</button> <!-- currently unused, kept if a menu is desired later here instead-->
                            <button class="action-btn" id="import-bibtex-btn">Import <strong>BibTeX</strong></button>                                
                        </div>
                        <div class="header-controls">
                            <button class="action-btn" id="export-btn"><strong>Export</strong> & Backup</button>
                        </div>
                        <div class="header-branding"><span>Research</span><span style="font-weight: 600; color: var(--primary-ui-color);">ParÃ§a</span> Lite</div>
                        <div class="header-controls">
                            <button class="action-btn" id="parÃ§a-tools-btn" style="display:none" ><strong>Batch</strong> Tasks</button>
                        </div>
                        <div class="header-controls">
                            <button class="action-btn" id="stats-btn">View <strong>Statistics</strong> <span style="color:#fff6">(F4)</span></button>
                        </div>
                        <div class="header-controls">
                            <button class="action-btn" id="about-btn" title="About / Help" ><span>?</span></button>
                        </div>
                    </div>
                </th>
            </tr>
            <tr>
                <th class="ontop-header" colspan="6" rowspan="2"> 
                    <div class="header-filters">
                        <div class="filter-item">
                            <label for="min-page-count">Min. page count â‰¥</label>
                            <input type="number" id="min-page-count" value="{{ min_page_count_value }}" min="0" max="9">
                        </div>
                        <div class="filter-item">
                            <label for="year-from">Year:</label>
                            <input type="number" id="year-from" value="{{ year_from_value }}" min="2010" max="2026">
                            <label for="year-to">to</label>
                            <input type="number" id="year-to" value="{{ year_to_value }}" min="2010" max="2026">
                        </div>
                        <div class="header-checkboxes">
                            <!-- This button will now trigger a page reload with updated URL parameters -->
                            <button class="action-btn" id="apply-serverside-filters" style="opacity:0; pointer-events: none;"><span>Apply</span></button>
                            <div class="filter-item">
                                <label for="hide-offtopic-checkbox">Hide Off-topic</label>
                                <input type="checkbox" title="Enable to Hide Offtopic papers" id="hide-offtopic-checkbox" name="hide-offtopic-checkbox" {% if hide_offtopic == true %}checked{% endif %}>
                            </div>
                            <div class="filter-item">
                                <label for="only-survey-checkbox">Filter surveys</label>
                                <input type="checkbox" title="Enable to only show Surveys" id="only-survey-checkbox">
                            </div>
                        </div>
                    </div>
                </th>
                <th class="ontop-header" colspan="7" rowspan="2" >
                    <div class="search-container">
                        <input type="search" id="search-input" placeholder="(F3) Type to search all fields..." value="{{ search_query_value }}">
                        <button type="button" id="clear-search-btn" class="clear-btn" title="Clear search">&times;</button>
                    </div>
                </th>
            </tr>
            <tr>
                <th class=" ontop-header" colspan="1">
                </th>
                <th class=" ontop-header" colspan="1"></th>
                <th class=" ontop-header" colspan="1">
                    <div>
                    </div>
                </th>
            </tr>
            <tr>
                <th class="rotate-header status-header editable-header" data-sort="pdf-link"><div><span>PDF</span></div> <span class="sort-indicator"></span></th>
                <th data-sort="title">Title (Click for article) <span class="sort-indicator"></span></th>
                <th data-sort="authors">Authors <span class="sort-indicator"></span></th>
                <th data-sort="year">Year <span class="sort-indicator"></span></th>
                <th class="rotate-header" data-sort="page_count" ><div><span>Pages</span></div> <span class="sort-indicator"></span></th>
                <th data-sort="journal">Journal/Conf <span class="sort-indicator"></span></th>    
                <th class="rotate-header status-header editable-header" data-sort="type"><div><span>Type</span></div> <span class="sort-indicator"></span></th>

                <!-- Classification Summary Columns -->
                <th class=" rotate-header status-header editable-header" data-sort="is_offtopic"><span class="sort-indicator"></span><div><span>Off-topic</span></div></th>
                <th class=" rotate-header status-header" data-sort="relevance"><span class="sort-indicator"></span><div><span>Relevance</span></div></th>
                <th class=" rotate-header status-header editable-header" data-sort="is_survey"><span class="sort-indicator"></span><div><span>Survey</span></div></th>

                <th data-sort="changed">Last Changed <span class="sort-indicator"></span></th>
                <th class="rotate-header status-header" data-sort="user_comment_state"><span class="sort-indicator"></span><div><span>Commented</span></div></th>
                <th class="rotate-header"><div>Details</div></th> <!-- must be 50px due to 'collapse' button text -->
                <!-- Hidden metadata fields -->
                <th style="display:none" colspan="4"></th>
            </tr>
        </thead>
            <!-- tbody and tfoot come from the papers_table template-->
            {{ papers_table_content | safe }}        
            
            {% include 'papers_table_tfoot.html' %}
            <!-- Use the rendered table content passed from the server --> 
    </table>
</div>

<div id="batchModal" class="modal">
    <div id="batch-actions">
        <div>
            <button class="action-btn" id="classify-remaining-btn">Classify <strong>Remaining</strong> </button>
            <button class="action-btn" id="classify-impl-btn">Re-Classify <strong>Primary</strong></button>
        </div>
        <div>
            <button class="action-btn" id="classify-misclassified-btn">Re-Classify <strong>Suspects</strong> </button>
            <button class="action-btn" id="classify-all-btn">Re-Classify <strong>All</strong></button>
        </div>
        <span class="menu-message">Batch classifications also run corresponding verifications automatically. Run the tasks below if you still need just verification (e.g., if an earlier run was aborted after classification)</span>
        <div>
            <button class="action-btn" id="verify-remaining-btn">Verify <strong>Remaining</strong></button>
            <button class="action-btn" id="verify-all-btn">Re-Verify <strong>All</strong></button>
        </div>
        <span class="menu-message" id="batch-status-message">These tools stay running in background after being called. Reload the webpage after a while to see updated results.
            <br><br> For actions on single papers, user the buttons in the corresponding paper's detail pane instead.
        </span> 
    </div>
</div>

<div id="importModal" class="modal">
    <div id="import-actions">
        <!-- unused, kept if a menu is desired here later (animations, etc. already done) -->
    </div>
</div>

<div id="exportModal" class="modal">
    <div id="export-actions">
        <div>
            <button class="action-btn" id="export-html-btn">Export <strong>HTML</strong></button>
            <button class="action-btn" id="export-xlsx-btn">Export <strong>XLSX</strong></button>
        </div>        
        <div>
            <button class="action-btn" id="backup-btn" > <strong>Create </strong>Backup</button>
            <button class="action-btn" id="restore-btn" > <strong>Restore </strong>Backup</button>
        </div>
        <span class="menu-message" id="backup-status-message">Backups include the database, original and annotated PDFs, HTML export and a XLSX spreadsheet.
            <br><br>Restoring from a backup overwrites all existing data!
        </span>
    </div>
</div>

<div id="statsModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        {% include 'stats_modal_content.html' %}
    </div>
</div>

<div id="aboutModal" class="modal">
    <div class="modal-small-content">
        <span class="close">&times;</span>      
        {% include 'about_modal_content.html' %}
    </div>
</div>
</body>
</html>