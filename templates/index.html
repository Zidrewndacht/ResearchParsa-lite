<!-- templates/index.html -->
<!DOCTYPE html>
<html class="busyCursor">
<head>
    <title>PCB Inspection Papers</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='fonts.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">

    <script src="{{ url_for('static', filename='chart.js') }}"></script>
    <script src="{{ url_for('static', filename='comms.js') }}" defer></script>
    <script src="{{ url_for('static', filename='filtering.js') }}" defer></script>
    <!-- <script src="{{ url_for('static', filename='ghpages.js') }}" defer></script> -->
</head>
<body>
<input type="file" id="bibtex-file-input" accept=".bib" style="display: none;"> <!-- Hidden file input for BibTeX upload -->
<div class="table-container">
    <div id="papers-table-container">
        <table id="papersTable" style="table-layout: fixed;">
            <colgroup>
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Column 1: Type (Rotated Header) -->
                <col style="width: 66%"> <!-- Column 2: Title (Should Expand)-->
                <col style="width: 40px; min-width: 40px; max-width:40px;"> <!-- Column 3: Year -->
                <col style="width: 34%"> <!-- Column 4: Journal/Conf (Should Expand) -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Column 5: Pages (Rotated Header) -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Off-topic -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Relevance -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Survey -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- THT -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- SMT -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- X-Ray -->

                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Tracks -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Holes -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Solder Insufficient -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Solder Excess -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Solder Void -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Solder Crack -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Missing Comp -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Wrong Comp -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Orientation -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Cosmetic -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Other -->

                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Classic CV -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- ML -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- CNN Classifier -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- CNN Detector -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- R-CNN Detector -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Transformers -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Other -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Hybrid -->
                <col style="width: 30px; min-width: 30px; max-width:30px;"> <!-- Datasets  -->
                <!-- Columns 31-36: Other Data (Mixed Sizes) -->
                <col style="width: 56px; min-width: 56px; max-width: 56px;"> <!-- Last Changed -->
                <col style="width: 56px; min-width: 56px; max-width: 56px;"> <!-- Changed By -->
                <col style="width: 50px; min-width: 50px; max-width: 50px;"> <!-- Verified -->
                <col style="width: 32px; min-width: 32px; max-width: 32px;"> <!-- Accr. Score -->
                <col style="width: 50px; min-width: 50px; max-width: 50px;"> <!-- Verified By -->
                <col style="width: 30px; min-width: 30px; max-width: 30px;"> <!-- user comments state -->
                <col style="width: 44px; min-width: 44px; max-width: 44px;"> <!-- Details -->
            </colgroup>
            <thead>
                <tr>
                    <th id="main-header-wrapper" colspan=38>
                    <div class="main-header">
                        <div class="header-controls">
                            <button class="action-btn" id="import-bibtex-btn">Import <strong>BibTeX</strong></button>
                            <button class="action-btn" id="export-html-btn">Export <strong>HTML</strong></button>
                        </div>
                        <div class="header-filters">
                            <!-- Moved to ontop-header -->
                        </div>
                        <div class="header-controls">
                            <div class="batch-actions">
                                <span id="batch-status-message"></span> <!-- For feedback -->
                                <button class="action-btn" id="classify-remaining-btn">Classify <strong>Remaining</strong></button>
                                <button class="action-btn" id="classify-all-btn">Re-Classify <strong>All</strong></button>
                                <button class="action-btn" id="verify-remaining-btn">Verify <strong>Remaining</strong></button>
                                <button class="action-btn" id="verify-all-btn">Re-Verify <strong>All</strong></button>
                                <!-- <button class="action-btn" id="fullscreen-btn" title="Fullscreen"><span>⇲</span></button> -->
                            </div>
                        </div>
                        <div class="header-controls">
                            <button class="action-btn" id="stats-btn">Check <strong>Stats</strong></button>
                            <button class="action-btn" id="about-btn" title="Help"><span>?</span></button>
                        </div>
                    </div>
                    </td>
                </tr>
                <tr>
                    <th class="ontop-header" colspan="5" rowspan="2"> 
                        <div class="header-filters" style="min-width: 540px;">
                            <div class="filter-item">
                                <label for="min-page-count">Min. page count ></label>
                                <input type="number" id="min-page-count" value="{{ min_page_count_value }}" min="0" max="9">
                            </div>
                            <div class="filter-item">
                                <label for="year-from">Year:</label>
                                <input type="number" id="year-from" value="{{ year_from_value }}" min="2010" max="2026">
                                <label for="year-to">to</label>
                                <input type="number" id="year-to" value="{{ year_to_value }}" min="2010" max="2026">
                            </div>
                            <!-- This button will now trigger a page reload with updated URL parameters -->
                            <button class="action-btn" id="apply-serverside-filters" style="display: none;"><span>Apply</span></button>
                        </div>
                    </th>
                    <th class="inferred-header" colspan="26" style="background: linear-gradient(90deg, hsl(170, 25%, 40%), rgb(77, 128, 92));"><!--NLP--->Inferred data</th>
                    
                    <th class="ontop-header" colspan="7" rowspan="2" >
                        <!-- <input type="search" id="search-input" placeholder="Type to search all fields..."> -->
                        <input type="search" id="search-input" placeholder="Type to search all fields..." value="{{ search_query_value }}">
                    </th>
                </tr>
                <tr>
                    <th class="inferred-header ontop-header" colspan="1"><input type="checkbox" title="Enable to Hide Offtopic papers" id="hide-offtopic-checkbox" {% if hide_offtopic == true %}checked{% endif %}></th>
                    <th class="inferred-header ontop-header" colspan="1"></th>
                    <th class="inferred-header ontop-header" colspan="1"><input type="checkbox" title="Enable to only show Surveys" id="only-survey-checkbox"></th>
                    <th class="inferred-header ontop-header" colspan="2"></th>
                    <th class="inferred-header ontop-header" colspan="1"><input type="checkbox" title="Enable to Hide X-Ray" id="hide-xray-checkbox" checked></th><!-- client-side, default enabled -->
                    <th class="inferred-header inferred-header-2 ontop-header" colspan="2">Features:</th>
                    <th class="inferred-header inferred-header-2 ontop-header" colspan="4">Solder</th>
                    <th class="inferred-header inferred-header-2 ontop-header" colspan="5">PCBA</th>
                    <th class="inferred-header inferred-header-3 ontop-header" colspan="8">Techniques</th>
                    <!-- <th class="inferred-header inferred-header-3 ontop-header" colspan="6">DL-based</th> -->
                    <th class="inferred-header inferred-header-3 ontop-header" colspan="1"></th>
                </tr>
                <tr>
                    <th class="rotate-header status-header editable-header" data-sort="type"><div><span>Type</span></div></span><span class="sort-indicator"></span></th>

                    <th data-sort="title">Title (Click for article) <span class="sort-indicator"></span></th>
                    <!-- <th data-sort="authors">Authors <span class="sort-indicator"></span></th> -->
                    <th data-sort="year">Year <span class="sort-indicator"></span></th>
                    <th data-sort="journal">Journal/Conf <span class="sort-indicator"></span></th>    
                    <th class="rotate-header" data-sort="page_count" ><div><span>Pages</span></div> <span class="sort-indicator"></span></th>


                    <!-- Classification Summary Columns -->
                    <th class="inferred-header rotate-header status-header editable-header" data-sort="is_offtopic"><span class="sort-indicator"></span><div><span>Off-topic</span></div></th>
                    <th class="inferred-header rotate-header status-header" data-sort="relevance"><span class="sort-indicator"></span><div><span>Relevance</span></div></th>
                    <th class="inferred-header rotate-header status-header editable-header" data-sort="is_survey"><span class="sort-indicator"></span><div><span>Survey</span></div></th>
                    <th class="inferred-header rotate-header status-header editable-header" data-sort="is_through_hole"><span class="sort-indicator"></span><div><span>THT</span></div></th>
                    <th class="inferred-header rotate-header status-header editable-header" data-sort="is_smt"><span class="sort-indicator"></span><div><span>SMT</span></div></th>
                    <th class="inferred-header rotate-header status-header editable-header" data-sort="is_x_ray"><span class="sort-indicator"></span><div><span>X-Ray</span></div></th>

                    <!-- Features Summary Columns (Updated list) -->
                    <th class="inferred-header inferred-header-2 rotate-header status-header editable-header" data-sort="features_tracks"><span class="sort-indicator"></span><div><span>Tracks</span></div></th>
                    <th class="inferred-header inferred-header-2 rotate-header status-header editable-header" data-sort="features_holes"><span class="sort-indicator"></span><div><span>Holes / Vias</span></div></th>

                    <th class="inferred-header inferred-header-2 rotate-header status-header editable-header" data-sort="features_solder_insufficient"><span class="sort-indicator"></span><div><span>Insufficient</span></div></th>
                    <th class="inferred-header inferred-header-2 rotate-header status-header editable-header" data-sort="features_solder_excess"><span class="sort-indicator"></span><div><span>Excessive</span></div></th>
                    <th class="inferred-header inferred-header-2 rotate-header status-header editable-header" data-sort="features_solder_void"><span class="sort-indicator"></span><div><span>Void / Hole</span></div></th>
                    <th class="inferred-header inferred-header-2 rotate-header status-header editable-header" data-sort="features_solder_crack"><span class="sort-indicator"></span><div><span>Crack / Cold</span></div></th>
                    
                    <th class="inferred-header inferred-header-2 rotate-header status-header editable-header" data-sort="features_missing_component"><span class="sort-indicator"></span><div><span>Missing Comp</span></div></th>
                    <th class="inferred-header inferred-header-2 rotate-header status-header editable-header" data-sort="features_wrong_component"><span class="sort-indicator"></span><div><span>Wrong Comp</span></div></th>
                    <th class="inferred-header inferred-header-2 rotate-header status-header editable-header" data-sort="features_orientation"><span class="sort-indicator"></span><div><span>Orientation</span></div></th>
                    <th class="inferred-header inferred-header-2 rotate-header status-header editable-header" data-sort="features_cosmetic"><span class="sort-indicator"></span><div><span>Cosmetic</span></div></th>
                    <th class="inferred-header inferred-header-2 rotate-header status-header editable-header" data-sort="features_other_state"><span class="sort-indicator"></span><div><span>Other</span></div></th>

                    <!-- Techniques Summary Columns (Updated list) -->
                    <th class="inferred-header inferred-header-3 rotate-header status-header editable-header" data-sort="technique_classic_cv_based"><span class="sort-indicator"></span><div><span>Classic CV</span></div></th>
                    <th class="inferred-header inferred-header-3 rotate-header status-header editable-header" data-sort="technique_ml_traditional"><span class="sort-indicator"></span><div><span>ML</span></div></th>
                    <th class="inferred-header inferred-header-3 rotate-header status-header editable-header" data-sort="technique_dl_cnn_classifier"><span class="sort-indicator"></span><div><span>CNN Classifier</span></div></th>
                    <th class="inferred-header inferred-header-3 rotate-header status-header editable-header" data-sort="technique_dl_cnn_detector"><span class="sort-indicator"></span><div><span>CNN Detector</span></div></th>
                    <th class="inferred-header inferred-header-3 rotate-header status-header editable-header" data-sort="technique_dl_rcnn_detector"><span class="sort-indicator"></span><div><span>R-CNN Detector</span></div></th>
                    <th class="inferred-header inferred-header-3 rotate-header status-header editable-header" data-sort="technique_dl_transformer"><span class="sort-indicator"></span><div><span>Transformer</span></div></th>
                    <th class="inferred-header inferred-header-3 rotate-header status-header editable-header" data-sort="technique_dl_other"><span class="sort-indicator"></span><div><span>Other DL</span></div></th>
                    <th class="inferred-header inferred-header-3 rotate-header status-header editable-header" data-sort="technique_hybrid"><span class="sort-indicator"></span><div><span>Hybrid</span></div></th>
                    <th class="inferred-header inferred-header-3 rotate-header status-header editable-header" data-sort="technique_available_dataset"><span class="sort-indicator"></span><div><span>Datasets</span></div></th>

                    <th data-sort="changed">Last Changed <span class="sort-indicator"></span></th>
                    <th data-sort="changed_by">Changed By <span class="sort-indicator"></span></th>
                    <th data-sort="verified"><!--<input type="checkbox" title="Enable to only show misclassification suspects" id="hide-approved-checkbox">-->Verified <span class="sort-indicator"></span></th>
                    <th class="rotate-header" data-sort="estimated_score"><div><span>Accr. Score</span></div> <span class="sort-indicator"></span></th>
                    <th data-sort="verified_by">Verified By <span class="sort-indicator"></span></th>
                    <th class="rotate-header status-header" data-sort="user_comment_state"><span class="sort-indicator"></span><div><span>Ccommented</span></div></th>
                    <th class="rotate-header"><div>Details</div></th> <!-- must be 50px due to 'collapse' button text -->
                </tr>
            </thead>
                <!-- tbody and tfoot come from the papers_table template-->
                {{ papers_table_content | safe }}        
                
                {% include 'papers_table_tfoot.html' %}
                <!-- Use the rendered table content passed from the server --> 
        </table>
    </div>
</div>
<!-- Stats Modal -->
<div id="statsModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <!-- <p> Data in <strong>all lists</strong> below is dynamically calculated based on <strong>currently visible</strong> papers:</p> -->
        <div class="stats-lists">
            <div class="stats-section">
                <h3>Repeating <strong>Journal/Conferences</strong></h3> 
                <ul id="journalStatsList"  class="stats-list-multicolumn-2"></ul>
            </div>
            <div class="stats-section">
                <h3>Repeating <strong>Keywords</strong></h3>
                <ul id="keywordStatsList" class="stats-list-multicolumn-short"></ul>        
            </div>
            <div class="stats-section">
                <h3>Repeating <strong>Authors</strong></h3>
                <ul id="authorStatsList" class="stats-list-multicolumn-short"></ul>
            </div>
            <div class="stats-section">
                <h3>Repeating <strong>Research Areas</strong></h3>
                <ul id="researchAreaStatsList" class="stats-list-multicolumn-short"></ul>
            </div>
            <div class="stats-section">
                <h3>Mentioned <strong>other detected features</strong>:</h3>
                <ul id="otherDetectedFeaturesStatsList" class="stats-list-multicolumn-short"></ul>
                <!-- show every non-blank instance of paper.features.other here. TBD. Can't be done client-side because detail row is lazy-loaded-->
            </div>
            <div class="stats-section">
                <h3>Mentioned <strong>Model Names</strong></h3>
                <ul id="modelNamesStatsList" class="stats-list-multicolumn-short"></ul>
                <!-- show every non-blank instance of paper.features.other here. TBD. Can't be done client-side because detail row is lazy-loaded-->
            </div>
        </div>
                
        <div class="stats-charts">
            <div class="stats-section">
                <h3><strong>Techniques</strong> Distribution</h3>
                <div class="chart-container" style="height:32vh; width:315px; max-width: 315px; margin: auto;">
                    <canvas id="techniquesPieChart"></canvas>
                </div>
            </div>
            <div class="stats-section">
                <h3><strong>Features</strong> Distribution</h3>
                <div class="chart-container" style="height:32vh; width:315px; max-width: 315px; margin: auto;">
                    <canvas id="featuresPieChart"></canvas>
                </div>
            </div>
            <div class="stats-section">
                <h3>Info / <strong>Other</strong> stats</h3>
                <p> Data in this page below is dynamically calculated based on <strong>currently visible</strong> papers.</p>
            </div>
        </div>
        <div class="stats-charts">
            <div class="stats-section">
                <h3><strong>Techniques</strong> per Year <span style="font-size:0.6em"> — Click on a label to show/hide its data and reflow the chart</span></h3>
                <div class="chart-container-fullwidth" style="height:32vh; margin: auto;">
                    <canvas id="techniquesPerYearLineChart"></canvas>
                </div>
            </div>

            <div class="stats-section">
                <h3><strong>Features</strong> per Year</h3>
                <div class="chart-container-fullwidth" style="height:32vh; margin: auto;">
                    <canvas id="featuresPerYearLineChart"></canvas>
                </div>
            </div>
            <div class="stats-section">
                <h3><strong>Survey</strong> vs <strong>Implementation</strong> Papers per Year</h3>
                <div class="chart-container-fullwidth" style="height:20vh;  margin: auto;">
                    <canvas id="surveyVsImplLineChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="aboutModal" class="modal" style="display: none;">
    <div class="modal-small-content">
        <span class="close">&times;</span>
    </div>
</div>
</body>
</html>